document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("startBtn"),s=document.getElementById("prompt"),i=document.getElementById("results"),l=document.getElementById("average");let t=[],a=0;const c=()=>{t=[],i.innerHTML="",l.textContent="",r.disabled=!1,s.classList.add("hidden")},m=()=>{r.disabled=!0,s.classList.add("hidden");const n=1e3+Math.random()*2e3;setTimeout(()=>{s.classList.remove("hidden"),a=performance.now()},n)},g=()=>{if(a===0)return;const n=performance.now()-a;t.push(n);const e=document.createElement("div");if(e.textContent=`Trial ${t.length}: ${n.toFixed(1)} ms`,i.appendChild(e),t.length<5)a=0,m();else{const o=t.reduce((d,p)=>d+p,0)/t.length;l.textContent=`Average: ${o.toFixed(1)} ms`,alert(`あなたの平均スコアは ${o.toFixed(1)} ms でした🕰️🌟`),u(o.toFixed(1))}};async function u(n){if(!window.isLoggedIn){c();return}try{const e=await fetch("/api/scores",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({average_score:n})});if(!e.ok){const d=await e.json();alert("保存に失敗しました: "+(d.message||e.statusText));return}const o=await e.json();console.log(o),alert("スコア保存完了🌟")}catch(e){console.error(e),alert("通信エラーが発生しました")}finally{c()}}r.addEventListener("click",()=>{c(),m()}),s.addEventListener("click",g)});
